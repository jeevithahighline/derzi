<div class="container p-4">
 
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
    <div class="col-6">
      <div class="heading pt-2">
        <h2>{{ bannerId ? 'Edit Banner' : 'Add Banner' }}</h2>
      </div>
    </div>
    <div class="col-6 dflexmain">       
      <button class="btn-add" (click)="saveBanner()"> Save</button>      
      <button class="btn-cancel" (click)="onCancel()">  Cancel</button>
    </div>
  </div>

  <div class="row">&nbsp;</div>
  <!---Form Section-->
  <div class="bg-white p-2 border rounded ">
    <form [formGroup]="dynamicForm" (ngSubmit)="saveBanner()" class="p-4 grid">
  
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 ">
        <!-- Title -->
        <div class="w-full">
          <label>Title</label><span class="required-astreik">*</span>
          <mat-form-field class="w-full">
            <input matInput formControlName="title" placeholder="Enter title" />
            <mat-error *ngIf="f['title'].hasError('minlength')">
              Minimum 3 characters required
            </mat-error>
          </mat-form-field>
        </div>
    
        <!-- Title Arabic -->
        <div class="w-full">
          <label>Title - Arabic</label><span class="required-astreik">*</span>
          <mat-form-field class="w-full">
            <input matInput formControlName="title_ar" placeholder="Enter title in Arabic" />
            <mat-error *ngIf="f['title_ar'].hasError('minlength')">
              Minimum 3 characters required
            </mat-error>
          </mat-form-field>
        </div>
      </div>
    
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 ">
        <!-- Description -->
        <mat-form-field class="w-full">
          <mat-label>Description</mat-label>
          <textarea matInput rows="3" formControlName="description"></textarea>
          <mat-error *ngIf="f['description'].hasError('maxlength')">
            Maximum 250 characters allowed
          </mat-error>
        </mat-form-field>
    
        <!-- Description Arabic -->
        <mat-form-field class="w-full">
          <mat-label>Description - Arabic</mat-label>
          <textarea matInput rows="3" formControlName="description_ar"></textarea>
          <mat-error *ngIf="f['description_ar'].hasError('maxlength')">
            Maximum 250 characters allowed
          </mat-error>
        </mat-form-field>
      </div>
    
      <!-- ✅ Banner Type -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 ">
        <mat-form-field class="w-full">
          <mat-label>Banner Type</mat-label>
          <mat-select formControlName="bannerType" (selectionChange)="onBannerTypeChange($event.value)">
            <mat-option value="page">Page</mat-option>
            <mat-option value="merchant">Merchant</mat-option>
            <mat-option value="category">Category</mat-option>
            <mat-option value="product">Product</mat-option>
          </mat-select>
          <mat-error *ngIf="f['bannerType'].hasError('required')">
            Banner Type is required
          </mat-error>
        </mat-form-field>
    
        <!-- ✅ Dynamic entity dropdown (changes based on banner type) -->
        <mat-form-field class="w-full" *ngIf="entityOptions.length > 0">
          <mat-label>{{ selectedBannerType | titlecase }}</mat-label>
          <mat-select formControlName="entityId">
            <mat-option *ngFor="let option of entityOptions" [value]="option.id">
              {{ option.name }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="f['entityId'].hasError('required')">
            Please select a {{ selectedBannerType }}
          </mat-error>
        </mat-form-field>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 ">

        <mat-form-field class="w-full">
          <mat-label>Image</mat-label>
        
          <!-- hidden file input (❌ no formControlName here) -->
          <input
            type="file"
            class="hidden"
            #fileInput
            (change)="onFileSelected($event)"
          />
        
          <!-- fake input to display file name -->
          <input
            matInput
            placeholder="Choose file"
            [value]="selectedFileName"
            readonly
            (click)="fileInput.click()"
          />
        
          <button mat-icon-button matSuffix (click)="fileInput.click()" type="button">
            <mat-icon>upload</mat-icon>
          </button>
        
          <mat-error *ngIf="f['image'].hasError('required') && f['image'].touched">
            Image is required
          </mat-error>
        </mat-form-field>       
      
      
        <!-- Status -->
        <mat-form-field appearance="outline">
          <mat-label>Status</mat-label>
          <mat-select formControlName="status">
            <mat-option [value]="true">Active</mat-option>
            <mat-option [value]="false">Inactive</mat-option>
          </mat-select>
          <!-- <mat-error *ngIf="dynamicForm.get('status')?.hasError('required')">
            Status is required
          </mat-error> -->
        </mat-form-field>

      </div>
      
    
    </form>

  </div>

</div>
